<!-- Begin Revised Rmarkdown file -->
---
title: "Introduction to Plotting in R for Air Quality Data Analysis"
author: "Fluent Data"
date: "2023-06-16"
description: "A comprehensive guide to using R for air quality data analysis, focusing on plotting techniques."
output: 
  html_document: 
    keep_md: yes
---

# Introduction to Plotting in R for Air Quality Data Analysis

This guide provides a comprehensive overview of using R for air quality data analysis, with a focus on plotting techniques. We will cover the basics of data visualization in R, explore different types of plots, and learn how to create visually appealing and informative graphs using the base graphics system, as well as the `lattice` and `ggplot2` packages.

## Getting Started

Before we dive into plotting air quality data, let's first load the necessary packages and import the dataset we'll be working with. We will be using the `chicago_air` dataset from the `region5air` package.

```{r}
library(region5air)
data(chicago_air)
head(chicago_air)
```

The `chicago_air` dataset contains information about ozone levels, temperature, solar radiation, and other variables recorded in Chicago. We will utilize this dataset to create various plots and visualizations.

## Base Graphics

The base graphics system in R provides a simple and intuitive way to create basic plots. At its core, the `plot()` function is used to visualize data with two numeric vectors representing the x and y coordinates.

Let's start by plotting ozone levels against temperature using the `plot()` function.

```{r}
plot(chicago_air$temp, chicago_air$ozone)
```

To plot data over time, we need to convert the `date` column to a `Date` data type.

```{r}
chicago_air$date <- as.Date(chicago_air$date)
```

Now, let's create a line graph of ozone levels over time.

```{r}
plot(chicago_air$date, chicago_air$ozone, type = 'l')
```

We can also create multiple graphs in a single plot by using the `par()` function to define the grid layout. Here's an example of plotting ozone levels and temperature over time side by side.

```{r}
par(mfrow = c(1,2))

plot(chicago_air$date, chicago_air$ozone, 
     type='l', 
     pch = 16,
     col = "purple", 
     lwd = 2.5,
     xlab="Date", 
     ylab = 'Ozone (ppm)', 
     main = 'Chicago Ozone Data')

plot(chicago_air$date, chicago_air$temp, 
     type='l', 
     xlab = "Date",
     ylab= 'Ozone (ppm)',
     main = 'Chicago Temperature Data')

dev.off()
```

To create a bar plot with a reference line representing the National Ambient Air Quality Standards (NAAQS) standard, use the `barplot()` and `abline()` functions.

```{r}
bar_plot <- barplot(height = chicago_air$ozone, 
                    names.arg = chicago_air$date,
                    xlab="Date", 
                    ylab="Ozone (ppm)", 
                    main = 'Chicago Ozone Data')

abline(h=.070, col="red")
```

## The Lattice Package

The `lattice` package provides a powerful and flexible system for creating conditioned plots. It allows us to easily split the data by conditioning variables and create plots for each subset of the data.

To use `lattice`, we need to install and load the package.

```{r}
install.packages("lattice")
library(lattice)
```

Let's create a line plot of ozone levels over time using the `xyplot()` function.

```{r}
xyplot(ozone ~ date, 
       data = chicago_air, 
       type = "l", 
       ylab = "Ozone (ppm)")
```

We can also create bar graphs using the `type = "h"` parameter.

```{r}
ozone_lattice <- xyplot(ozone ~ date,
                        data = chicago_air, 
                        type = "h", 
                        ylab = "Ozone (ppm)")
plot(ozone_lattice)
```

The `lattice` package allows for easy conditioning of the data. We can split the data by months and weekdays using the `factor()` function and create a box plot with `bwplot()`.

```{r}
chicago_air$month <- factor(months(chicago_air$date), 
                            labels = month.name)

chicago_air$weekday <- factor(weekdays(chicago_air$date, abbreviate = TRUE),
                              labels = c("Sun", "Mon", "Tue", "Wed", "Thu", 
                                         "Fri", "Sat"))

bwplot(ozone ~ weekday | month, 
       data = chicago_air,
       ylab = "Ozone (ppm)",
       xlab = "2013", 
       pch = '|',
       scales = list(x=list(rot=45)))
```

## The ggplot2 Package

The `ggplot2` package offers a layered approach to creating plots and is particularly useful for creating aesthetically appealing and customizable visualizations.

Let's install and load the `ggplot2` package.

```{r}
install.packages("ggplot2")
library(ggplot2)
```

The `ggplot()` function is the main entry point for creating plots with `ggplot2`. We provide a `data.frame` as the first argument and an aesthetic mapping using the `aes()` function. Additional plot information is added using `+` followed by `geom_*()` functions.

```{r}
ggplot(chicago_air, aes(x = date, y = ozone)) + geom_line()
```

To create conditioned graphs in `ggplot2`, we need to reshape the wide `data.frame` into a long format using the `pivot_longer()` function from the `tidyr` package.

```{r}
library(tidyr)

chicago_air$high_temp <- chicago_air$temp > 80

chicago_long <- pivot_longer(chicago_air, 
                             cols = c("ozone", "temp", "solar"),
                             names_to = "variable",
                             values_to = "value",
                             values_drop_na = TRUE)

head(chicago_long)
```

We can now plot the reshaped data using `ggplot2`. Let's create a plot with ozone levels and temperature over time, with high temperature values indicated by different colors.

```{r}
ggplot(chicago_long, aes(x = date, y = value, color = high_temp)) + 
  geom_point() +
  facet_grid(rows = "variable", scales = "free_y")
```

## Plotting Confidence Intervals

`ggplot2` makes it easy to plot shaded confidence intervals on graphs using the `geom_smooth()` function. Here's an example of creating a scatter plot of ozone levels against temperature, along with a fitted line and a 95% confidence shaded area.

```{r}
ggplot(chicago_air, aes(temp, ozone)) +
  geom_point() + 
  geom_smooth(method = lm)
```

We can also fit a loess curve for modeling local relationships in a nonlinear curve.

```{r}
ggplot(chicago_air, aes(temp, ozone)) +
  geom_point() + 
  geom_smooth(method = loess)
```

## Saving Plots

Plots can be easily saved in RStudio using the "Export" button at the top of the "Plots" pane.

![](img/save_plot.png)

Alternatively, you can save a plot created with `ggplot2` using the `ggsave()` function.

```{r}
my_plot <- ggplot(chicago_air, aes(temp, ozone)) +
  geom_point() + 
  geom_smooth(method = loess)

ggsave(filename = "my_plot.png", plot = my_plot)
```

Congratulations! You've learned the basics of plotting in R for air quality data analysis using the base graphics system, `lattice`, and `ggplot2` packages. Keep exploring and experimenting with different plotting techniques to gain more insights from your data.

## Exercises

1. Plot a scatterplot of solar radiation against temperature from the `chicago_air` dataset.
2. Create a bar plot of ozone levels for each month in Chicago. Include labels for months on the x-axis and give the plot an appropriate title.
3. Use `ggplot2` to create a line graph of temperature over time, with different line colors for high and low ozone levels.
4. Reshape the `chicago_air` dataset into a long format and create a stacked area plot of ozone levels, with months on the x-axis and ozone values stacked on the y-axis.

## Multiple Choice Questions

1. What function in R is used to create basic plots?
   - [ ] `latticeplot()`
   - [ ] `ggplot()`
   - [ ] `plotly()`
   - [x] `plot()`

2. Which package provides a flexible system for creating conditioned plots in R?
   - [ ] `base`
   - [x] `lattice`
   - [ ] `ggplot2`
   - [ ] `plotly`

3. In `ggplot2`, what function is used to add a fitted line to a scatter plot?
   - [ ] `geom_bar()`
   - [ ] `geom_point()`
   - [ ] `geom_boxplot()`
   - [x] `geom_smooth()`

4. How can a plot created with `ggplot2` be saved?
   - [ ] Use the "Export" button in the "Plots" pane in RStudio.
   - [ ] Use the `save_plot()` function from the `lattice` package.
   - [ ] Use the `save_plot()` function from the `ggplot2` package.
   - [x] Use the `ggsave()` function.

5. What function is used in R to convert a wide `data.frame` into a long format?
   - [ ] `pivot_long()`
   - [ ] `melt()`
   - [x] `pivot_longer()`
   - [ ] `gather()`

6. Which package provides the ability to create aesthetically appealing and customizable visualizations in R?
   - [ ] `base`
   - [x] `ggplot2`
   - [ ] `plotly`
   - [ ] `lattice`

7. How can multiple graphs be created in a single plot using the base graphics system in R?
   - [ ] By using the `facet_grid()` function.
   - [ ] By using the `par()` function to define the grid layout.
   - [ ] By using the `geom_*()` functions in `ggplot2`.
   - [x] By using the `mfrow` parameter in the `par()` function.

## Revisions

- Updated the title and author of the document to be more descriptive.
- Added a concise description of the content covered in the Rmarkdown file.
- Modified the code chunks to be more accurate and complete.
- Reorganized and rephrased the content to improve clarity and readability.
- Added examples and explanations for creating different types of plots.
- Included images and captions to visually enhance the document.
- Added exercises and multiple choice questions to test understanding.
<!-- End Revised Rmarkdown file -->