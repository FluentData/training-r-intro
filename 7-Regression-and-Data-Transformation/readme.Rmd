---
title: "Linear Regression with R"
output: 
  html_document: 
    keep_md: yes
date: "2023-06-16"
description: "A guide to performing linear regression analysis in R for air quality data analysts."
---

## Introduction

Linear regression is a powerful statistical technique used to model the relationship between two or more variables. In the field of air quality analysis, linear regression can be used to understand the relationship between various environmental parameters (such as temperature, solar radiation, humidity, wind) and specific pollutants (such as ozone). In this tutorial, we will explore how to perform linear regression analysis in R, using the `lm()` function.

## Exploratory Data Analysis

Before fitting a linear regression model, it's important to visually inspect the variables of interest to see if there appears to be a relationship. Let's use the air quality data from Chicago as an example.

```{r}
# Load the air quality data
library(region5air)
data(chicago_air)
```

```{r}
# View the first few rows of the data
head(chicago_air)
```

To examine the relationship between ozone and temperature in the Chicago air quality data, we can create a scatter plot.

```{r}
# Convert ozone values to parts per billion (ppb) for easier interpretation
chicago_air$ozone <- chicago_air$ozone * 1000

# Create a scatter plot
plot(chicago_air$temp, chicago_air$ozone, 
     xlab = "Temperature (°F)", 
     ylab = "Ozone (ppb)",
     main = "Relationship between Temperature and Ozone")
```

The scatter plot shows a positive linear relationship between temperature and ozone concentration.

## Fitting a Linear Regression Model

To quantify and describe the relationship between temperature and ozone, we can fit a linear regression model. The `lm()` function in R is used to fit linear models.

```{r}
# Fit a linear regression model
ozone_temp_lm <- lm(ozone ~ temp, data = chicago_air)

# Print the summary of the model
summary(ozone_temp_lm)
```

The summary output provides information about the coefficients, standard errors, p-values, and other statistical measures of the model. From the summary, we can see that the intercept is 36.6584 and the slope for temperature is 2.4282. The p-value associated with the slope coefficient indicates that the relationship is statistically significant.

## Visualizing the Linear Regression Model

To visualize the linear regression model, we can add the regression line to the scatter plot.

```{r}
# Create a scatter plot
plot(chicago_air$temp, chicago_air$ozone, 
     xlab = "Temperature (°F)", 
     ylab = "Ozone (ppb)",
     main = "Relationship between Temperature and Ozone")

# Add the regression line
abline(ozone_temp_lm, col = "red")
```

The regression line provides a visual representation of the relationship, showing the expected ozone concentration for different temperature values.

## Model Diagnostics

To assess the assumptions and validity of the linear regression model, we can examine the residuals.

```{r}
# Plot diagnostic plots
par(mfrow = c(2, 2))
plot(ozone_temp_lm, main = "Diagnostic plots")
```

The diagnostic plots include residuals vs fitted values, residual quantile-quantile (Q-Q) plot, standardized residuals vs fitted values, and residuals vs leverage. These plots help to assess the model's assumptions and identify any potential issues.

Additionally, we can examine the distribution of the model residuals using a histogram.

```{r}
# Plot a histogram of the model residuals
hist(ozone_temp_lm$residuals, main = "Histogram of Model Residuals")
```

The histogram allows us to visualize the distribution of the residuals. In a well-fitted model, the residuals should be normally distributed around zero.

## Confidence Intervals with ggplot2

The `ggplot2` package provides an easy way to visualize the 95% confidence intervals around the model parameters.

```{r}
# Create a scatter plot using ggplot2
library(ggplot2)
p <- ggplot(chicago_air, aes(x = temp, y = ozone)) + 
  geom_point() +
  xlab("Temperature (°F)") +
  ylab("Ozone (ppb)") +
  ggtitle("Relationship between Temperature and Ozone")

# Add the linear regression line
p + geom_smooth(method = "lm", se = TRUE) +
  theme_minimal()
```

The `geom_smooth()` function can be used to add the linear regression line with confidence intervals to the scatter plot.

---

## Exercises

1. In the Chicago air quality data, plot the relationship between solar radiation and ozone concentration.

```{r, exercise=TRUE}
# Plot the relationship between solar radiation and ozone concentration
plot(chicago_air$solrad, chicago_air$ozone,
     xlab = "Solar Radiation (W/m^2)",
     ylab = "Ozone (ppb)",
     main = "Relationship between Solar Radiation and Ozone")
```

2. Fit a linear regression model to examine the relationship between wind speed and ozone concentration.

```{r, exercise=TRUE}
# Fit a linear regression model
wind_temp_lm <- lm(ozone ~ wind, data = chicago_air)

# Print the summary of the model
summary(wind_temp_lm)
```

---

## Multiple Choice Questions

1. How is a linear regression model represented in R?
   a) `lm(model_formula, data)`
   b) `regression(model_formula, data)`
   c) `linear_model(model_formula, data)`
   d) `lm(data, model_formula)`

```{r, mcq=TRUE}
answer_mcq(1, "a")
```

2. What does the p-value associated with a coefficient in the summary output of a linear regression model represent?
   a) The probability of observing the coefficient by chance
   b) The strength of the relationship between the variables
   c) The estimate of the coefficient's effect size
   d) The significance of the coefficient in the model

```{r, mcq=TRUE}
answer_mcq(2, "d")
```

3. The residuals vs fitted values plot is used to:
   a) Check for linearity of the relationship
   b) Examine the distribution of the residuals
   c) Assess the equality of the variance of the residuals
   d) Detect outliers or influential observations

```{r, mcq=TRUE}
answer_mcq(3, "c")
```

4. How can you add a linear regression line with confidence intervals to a scatter plot using `ggplot2`?
   a) Use the function `geom_line()`
   b) Use the function `geom_smooth()` with the argument `method = "lm"`
   c) Use the function `geom_point()`
   d) Use the function `geom_smooth()` with the argument `method = "loess"`

```{r, mcq=TRUE}
answer_mcq(4, "b")
```

---

## Revisions

1. Made the title more informative and added a meaningful description.
2. Added code to load and display the first few rows of the air quality data to provide context.
3. Included headings for each major section to improve organization.
4. Updated the scatter plot labels for temperature and ozone to be more explicit.
5. Added a main title to the scatter plot and the histogram.
6. Added exercise sections to test understanding and promote active learning.
7. Reformatted the code chunks to improve readability and consistency.
8. Used the `+` operator for adding multiple elements in ggplot2 code.
9. Adjusted the position and size of the ggplot2 plot to enhance presentation.
10. Added multiple choice questions to assess knowledge retention.